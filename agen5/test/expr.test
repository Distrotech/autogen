#! /bin/sh
#  -*- Mode: Shell-script -*-
# ----------------------------------------------------------------------
# expr.test --- [= % name (sprintf "%%-18s" "%s") =] expression
#
# Time-stamp:      "2002-09-28 13:25:00 bkorb"
# Author:          Bruce Korb <bkorb@gnu.org>
# Maintainer:      Bruce Korb <bkorb@gnu.org>
# Created:         Sat Mar 28 14:21:31 1998
#
# $Id: expr.test,v 3.2 2002/09/29 00:16:20 bkorb Exp $
# ----------------------------------------------------------------------

# Common definitions
if test -z "$srcdir"; then
    srcdir=`echo "$0" | sed 's,[^/]*$,,'`
    test -z "$srcdir" && srcdir=.
    test "$srcdir" = "$0" && srcdir=.
    test "${VERBOSE+set}" != set && VERBOSE=1
fi
. $srcdir/defs

# # # # # # # TEMPLATE & DEFINITIONS FILES # # # # # # # # #
#
#  We construct this by pulling down the sources from the
#  AutoGen source directory.  We will also copy out the same
#  commands as are used there.  ${top_srcdir} is a full path.

cp ${top_srcdir}/agen5/snarf.tpl ${top_srcdir}/agen5/exp*.c \
   ${top_srcdir}/agen5/func*.c .

cat > ./${testname}.sh <<- _EOF_
GD="${GDEXE}"
AG="${AGEXE}"

_EOF_
sed -n '/  expr.ini /,/date > stamp-exprini/p' \
  ${top_srcdir}/agen5/bootstrap.dir | \
    sed '1d;$d' >> ./${testname}.sh

#  Remove the lines that *will* be different, always...
#
srcdir=. ${SHELL} -x ./${testname}.sh
sed '/DO NOT EDIT/,/and the template/d' ./expr.ini > expr.res
sed '/DO NOT EDIT/,/and the template/d' ${top_srcdir}/agen5/expr.ini \
    > expr.base

cmp expr.base expr.res || \
  failure "`diff -c expr.base expr.res`"

cleanup
# expr.test ends here
