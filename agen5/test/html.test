#! /bin/sh
#  -*- Mode: Shell-script -*-
# ----------------------------------------------------------------------
# html.test --- test include functionality
#
# Author:            Bruce Korb <bkorb@gnu.org>
# Maintainer:        Bruce Korb <bkorb@gnu.org>
# Created:           Fri Oct 1 10:27:31 PDT 1999
# Last Modified:     $Date: 2001/12/26 20:07:57 $
#            by:     Bruce Korb <bkorb@gnu.org>			      
#
# $Id: html.test,v 3.1 2001/12/26 20:07:57 bkorb Exp $
# ----------------------------------------------------------------------

# Common definitions
if test -z "$srcdir"; then
    srcdir=`echo "$0" | sed 's,[^/]*$,,'`
    test -z "$srcdir" && srcdir=.
    test "$srcdir" = "$0" && srcdir=.
    test "${VERBOSE+set}" != set && VERBOSE=1
fi
. $srcdir/defs

# # # # # # # # # # TEMPLATE FILE # # # # # # # # #

echo creating ${testname}.tpl
cat > ${testname}.tpl <<'_EOF_'
<? AutoGen5 Template ?>
<head>Mumble:  <? mumble ?></head>
<body>Foolish: <? foo ?></body>
_EOF_

# # # # # # # SAMPLE OUTPUT FILE # # # # # #

echo creating ${testname}.out in `pwd`
# this is the output we should expect to see
cat > ${testname}.samp <<'_EOF_'
Content-Type: text/html

<head>Mumble:  fumble bumble</head>
<body>Foolish: bar</body>
_EOF_

# # # # # # # RUN AUTOGEN # # # # # #

REQUEST_METHOD=GET
QUERY_STRING='mumble=fumble+bumble&foo=bar'
CONTENT_LENGTH=${#QUERY_STRING}

export CONTENT_LENGTH
export REQUEST_METHOD
export QUERY_STRING

$AGEXE -b ${testname} -T ${testname}.tpl > ${testname}.test || \
  failure autogen failed

# # # # # # # TEST RESULTS # # # # # #

cmp -s ${testname}.samp ${testname}.test || \
  failure "`diff ${testname}.samp ${testname}.test`"

cleanup
# end of output.test
