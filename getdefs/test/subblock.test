#! /bin/sh
#  -*- Mode: Shell-script -*-
# ----------------------------------------------------------------------
# subblock.test --- test the subblock parameter to getdefs
#
# Author:	     Bruce Korb <bkorb@gnu.org>
# Maintainer:	     Bruce Korb <bkorb@gnu.org>
# Created:	     Sat Mar 28 14:21:31 1998
# Last Modified:  $Date: 2000/04/04 13:23:32 $
#            by:     Bruce Korb <bkorb@gnu.org>
#
# $Id: subblock.test,v 1.5 2000/04/04 13:23:32 bkorb Exp $
# ----------------------------------------------------------------------

# Common definitions
if test -z "$srcdir"; then
    srcdir=`echo "$0" | sed 's,[^/]*$,,'`
    test -z "$srcdir" && srcdir=.
    test "$srcdir" = "$0" && srcdir=.
    test "${VERBOSE+set}" != set && VERBOSE=1
fi
. $srcdir/defs


# Create the files we need in the test environment
cat > $testname.c <<EOF
/*=gfunc in_p
 *
 * exparg: test-string , string to look for
 * exparg: @ string-list @ list of strings to check,, @@ list
 *
 * opt:  1
 * doc:  Return SCM_BOOL_T if the first argument is duplicated
 *      in the second (list) argument.
=*/
    SCM
ag_scm_in_p( SCM obj, SCM list )
{
}
EOF

cat > $testname.test <<EOF
/*
 *  DO NOT EDIT THIS FILE   (subblock.out)
 *
 *  It has been extracted by getdefs from the following files:
 *
 *      subblock.c
 */
autogen definitions testdir;

#line 1 "subblock.c"
gfunc = {
    name    = 'in_p';
    exparg = {
        arg_name = 'test-string';
        arg_desc = 'string to look for';
    };
    exparg = {
        arg_name = 'string-list';
        arg_desc = 'list of strings to check,,';
        arg_list = 'list';
    };
    opt = '1';
    doc = 'Return SCM_BOOL_T if the first argument is duplicated
in the second (list) argument.';
};
EOF

${GETDEFS} subblock=exparg=arg_name,arg_desc,arg_optional,arg_list \
	   output=$testname.out $testname.c || exit 1
cmp -s $testname.test $testname.out || failure unexpected output

# subblock.test ends here
