#!/bin/ksh
# -*- Mode: shell-script -*-
#
# $Id: announce.txt,v 4.18 2009/07/23 02:05:55 bkorb Exp $
#
# Time-stamp:        "2009-07-22 18:57:57 bkorb"
##
##  This file is part of AutoGen.
##  AutoGen copyright (c) 1992-2009 by Bruce Korb - all rights reserved
##
## AutoGen is free software: you can redistribute it and/or modify it
## under the terms of the GNU General Public License as published by the
## Free Software Foundation, either version 3 of the License, or
## (at your option) any later version.
##
## AutoGen is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
## See the GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License along
## with this program.  If not, see <http://www.gnu.org/licenses/>.

test -z "${sender}" && sender=bkorb
domain=gnu.org
lname=${sender}@${domain}
fullname='Bruce Korb'
project=autogen

tfile=$(mktemp ./agaXXXXXX.txt) 2>/dev/null
test -z "${tfile}" && tfile=aga$$.txt

eval $(egrep '^A[GO]_[A-Z0-9_]*=' VERSION)
AO_VERSION=AutoOpts\ Version\ ${AO_CURRENT}.${AO_REVISION}

exec 3> ${tfile}

recip=$(echo ${lname} autogen-announce@lists.sourceforge.net)

nl='
'

# Three levels of release:
# x.y        -- a primary release
# x.y.z      -- a bug fix release
# x.y.zpreX  -- an unofficial testing release
#
case ${AG_VERSION} in
*.*pre* )
  to_line='To: autogen-announce@lists.sourceforge.net'
  cc_line=""
  alpha_rel=$(echo "\
This is a *pre* release of ${project}.

It is temporarily stored at the following 'primary ftp' site,
pending further testing.")

  recip=autogen-announce@lists.sourceforge.net
  ftpurl=http://autogen.sf.net/data
  ;;

* )
  alpha_rel=""
  to_line='To: GNU Announcements <info-gnu@gnu.org>'
  cc_line="Cc: autogen-announce@lists.sourceforge.net${nl}"
  recip=$(echo ${recip} info-gnu@gnu.org)
  ftpurl=ftp://ftp.gnu.org/gnu/${project}/rel${AG_VERSION}
  ;;
esac

cat >&3 <<- _EOF_
	From: ${fullname} <${sender}@${domain}>
	Sender: ${sender}@${domain}
	${to_line}
	Subject: GNU AutoGen Version ${AG_VERSION}/${AO_VERSION}
	Reply-To: autogen-users@lists.sourceforge.net
	${cc_line}
	GNU AutoGen/AutoOpts is a two-part project that serves two separate
	purposes.  The two parts are combined because they are inextricably
	intertwined:

	AutoGen is a tool designed to simplify the creation and maintenance of
	programs that contain large amounts of repetitious text.  It is
	especially valuable in programs that have several blocks of text that
	must be kept synchronized.

	AutoOpts is both an example of that and a project in its own right.
	It is a very powerful command line option parser consisting of a set
	of AutoGen templates and a run time library that nearly eliminates
	the hassle of managing, parsing and documenting program options.

	New in ${AG_VERSION} - $(date '+%B, %Y')
	_EOF_

test ${#alpha_rel} -gt 1 && printf "${alpha_rel}\n\n" >&3

(
  case ${AG_VERSION} in
  *pre* )
    printf "\nHere are the change log entries since the last release\n\n"
    sed '/= [0-9.]* Released/,$d' ChangeLog | \
    sed '$d' | sed '$d' | sed '$d'
    ;;
  esac
) >&3

printf "\nHere are the 'NEWS' entries since the last release\n\n" >&3
sed "/^New in ${AG_VERSION} -/d ; /^New in /,\$d" NEWS >&3

cat >&3 <<_EOF_

AutoGen home:    http://www.gnu.org/software/${project}/
primary ftp:     ${ftpurl}/
.tar.gz:         ${ftpurl}/${project}-${AG_VERSION}.tar.gz
library project: $(echo ${ftpurl} | \
  sed "s,${project}/.*,libopts/rel${AO_CURRENT}.${AO_REVISION}/,")
bug reports:     autogen-users at the lists dot SourceForge net domain
bug archive:     http://sourceforge.net/mailarchive/forum.php?forum_id=7034
maintainer:      Bruce Korb - bkorb at the usual GNU domain
_EOF_

exec 3>&-
recip=bruce.korb@gmail.com

echo "sendmail ${recip} < ${tfile}"

echo rm -f ${tfile}
