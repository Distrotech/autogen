2004-03-13  Bruce Korb  <bkorb@gnu.org>

	* autoopts/autoopts.c(checkConsistency): "must-set" means that a "set"
	option is okay, too.
	* autoopts/configfile.c: more work on it.
	* autoopts/test/errors.test: test the consistency fix
	* agen5/autogen.c(doneCheck): run any 'shell-cleanup's
	* agen5/autogen.h(fmemopen): rename to ag_fmemopen
	* agen5/expGperf.c: append gperf cleanup stuff to 'shell-cleanup'
	* agen5/expOutput.c: rename of fmemopen
	* agen5/fmemopen.c: reworked
	* agen5/schemedef.scm(shell-cleanup): new text SCM variable
	* README: with-libguile-link and not with-libguile-libdir
	* agen5/agShell.c(zTrap): move to directive.tpl and rename
	* agen5/directive.tpl(zShellInit): write as a straight-up shell script
	and use the "c-string" macro to convert into a C initialization string.

2004-02-20  Bruce Korb  <bkorb@gnu.org>

	* autoopts/*: Remove "optArgType" from option descriptor and use
	OPTST_GET_ARGTYPE() macro to determine this instead.

2004-02-13  Bruce Korb  <bkorb@gnu.org>

	* autoopts/cook.c: NEW - move all string cooking here
	* agen5/agUtils.c(doEscapeChar): removed
	* agen5/defLex.c(assembleString): removed
	* autoopts/tokenize.c(copy_cooked): use cook book cook code.
	* autoopts/autoopts.c(doPresets): internalFileLoad has no failure mode
	* autoopts/configfile.c(internalFileLoad): so remove its return value
	* autoopts/load.c(findArg): routine to separate and process the option
	argument, "process" method depending on mode:  KEEP, UNCOOKED and COOKED.
	(loadOptionLine): use the new function.
	* autoopts/test/rc.test: test this new stuff
	* autoopts/Makefile.am(install-data-hook): sed in stuff derived from
	config.h (we cannot install that).
	* autoopts/autoopts.h(pzNest): new arg type for usage text
	* autoopts/enumeration.c(enumError): arg types now handled via an enum
	instead of bits in a mask.
	* autoopts/guileopt.c(export_options_to_guile): ditto
	* autoopts/makeshell.c(emitSetup): ditto
	* autoopts/putshell.c: the same
	* autoopts/save.c: again
	* autoopts/usage.c: and some more
	* autoopts/optlib.tpl: and again
	* autoopts/optcode.tpl: ditto, also rearranged man option structure
	* autoopts/options_h.tpl: new macros and enums for arg types
	Also rearranged main option structure, as we will be incompatible anyway.
	* autoopts/usage-txt.def: new strings for the new arg types
	* autoopts/test/*: Must specify the "config.h" header now.
	* config/libopts.def: either stdint.h or inttypes.h is required now
	* doc/auto_gen.tpl: make sure compiles pick up config.h
	* pkg/libopts/mklibsrc.sh: do *not* pick up config.h.  It will be
	generated at build time.

2004-02-12  Bruce Korb  <bkorb@gnu.org>

	* autoopts/text_mmap.c: new - maps text files, always ensuring that
	at least one NUL byte is after the last text byte.
	* autoopts/Makefile.am: Add to sources
	* autoopts/autoopts.h(tmap_info_t): and add to data structures
	* autoopts/configfile.c(internalFileLoad): new function for new job
	* autoopts/load.c(filePreset): move to "configfile.c"
	(doLoadOpt): ditto
	* autoopts/optlib.tpl(min): if there is no "min", but there is a
	"must-set", then set optMinCt to 1 anyway.
	* autoopts/test/main.test(main.DEF): accommodate file systems with
	case-insensitive naming -- use "def2" instead of ".DEF".
	* fiddle with configury some more.

2004-02-05  Bruce Korb  <bkorb@gnu.org>

	= 5.6.6 Released

	* autoopts/agman1.tpl(main): doc the new forms of "main" procedures
	* autoopts/test/Makefile.am(verbose): testing special target
	* autoopts/test/enums.test(do_proc[]): use printf, echo is unreliable

2004-02-03  Bruce Korb  <bkorb@gnu.org>

	* autoopts/agman1.tpl(configuration): replace "rc" in more places
	* autoopts/autoopts.c: ditto
	* autoopts/configfile.c: ditto
	* autoopts/optcode.tpl: ditto
	* autoopts/save.c: ditto
	* autoopts/test/*.test: ditto
	* autoopts/optmain.tpl(for-each): add a new attribute, "handler-type"
	It specifies: plain operands, file names only, file pointers to the
	files named, and content of the files.
	(each-or-stdin-main): deleted.  Not a useful concept.
	* doc/autogen.texi: doc this stuff.

2004-01-23  Bruce Korb  <bkorb@gnu.org>

	* autoopts/test/enums.test: fix ksh-isms
	(echo): guard against builtin echo interpreting '\\'
	* autoopts/test/handler.test: fix ksh-isms
	* agen5/autogen.c(signalSetup): do not override "RT" signals
	* agen5/defDirect.c(doDir_define): use "memmove" for memory shift
	* agen5/tpLoad.c(loadMacros): ditto
	* autoopts/save.c(optionSaveFile): only free mem that was allocated

2004-01-21  Bruce Korb  <bkorb@gnu.org>

	* agen5/expState.c(ag_scm_tpl_file_line): fix warning for 64 bits
	(ag_scm_def_file_line): ditto
	* agen5/schemedef.scm(c-file-line-fmt): new Scheme value
	* agen5/test/heredef.test: tweak test
	* agen5/test/opts.test: ditto
	* autoopts/opt*.tpl: add tpl-file-line functions here and there.
	* autoopts/Makefile.am(include_HEADERS): make them "nobase" as both
	options.h and usage-txt.h are to be installed in an an "autoopts" subdir.
	* */*: change #include directives
	* doc/*: change references from "rc files" and "ini files" to
	"configuration files".
	* pkg/libopts/mklibsrc.sh: cope with the new header subdirectory
	
2004-01-17  Bruce Korb  <bkorb@gnu.org>

	* autoopts/opt*.tpl: Remove all the #line stuff.  Bad idea for AutoOpts.
	* autoopts/save.c(findDirName): fix allocation size & mem leak.

2004-01-16  Bruce Korb  <bkorb@gnu.org>

	* agen5/autogen.h(tDefCtx): change name of file name to be unique
	(tDefEntry): reorder to put int values at end and add definition
	file name and line number.
	* agen5/*: s/tDefCtx.pzFileName/tDefCtx.pzCtxFname/
	* agen5/autogen.c(signalSetup): parameterize the functions to call
	upon signal receipt so that core dumps can happen.
	* agen5/defLoad.c(findPlace): insert def file name and line number
	* agen5/defParse-fsm.c(dp_do_tpl_name): modify definitions root init.
	* agen5/expState.c(ag_scm_def_file_line): new function to take advantage
	of the new fields in the tDefEntry structure.
	* agen5/test/heredef.test: test the definition file/line stuff
	* agen5/defLex.c(assembleHereString): count the newline at the end
	of the here string token, too.

2004-01-15  Bruce Korb  <bkorb@gnu.org>

	* autoopts/Makefile.am(configfile.c): new file
	* autoopts/configfile.c: move config file code here
	* autoopts/autoopts.c(doRcFiles): move and rename to configFileLoad()
	(ISNAMECHAR): remove
	* autoopts/autoopts.h(ISNAMECHAR): add
	* autoopts/load.c(loadOptionLine): add ':' to list of separation chars
	* autoopts/usage-txt.def(AO_Bad): new message
	* autoopts/test/rc.test(cat): fix inconsistent output
	* pkg/libopts/mklibsrc.sh(lo_cv_test_autoopts): handle test correctly

2004-01-08  Bruce Korb  <bkorb@gnu.org>

	* autoopts/options_h.tpl(streqv*): export these functions for programs
	that include the "options.h" header.
	autoopts/streqv.h: obsolete
	* autoopts/streqvcmp.c(streqv*): doc the functions so they are exported
	* autoopts/tokenize.h: obsolete
	* autoopts/tokenize.c(tokenize.h): don't include obsolete header
	(string_tokenize): doc the function so it is exported
	*/*.c: regularize the methods for declaring functions
	* compat/pathfind.c(pathfind): add to libopts if no native version
	* compat/compat.h(pathfind): remove declaration.
	* compat/libgen.h: obsolete
	* compat/strcspn.c(strcspn): part of POSIX.  We require POSIX.
	* config/confmacs.tpl(conditional): new test result type.  It must
	live in unconditional code.
	* config/misc.def(DO_SHELL_CMDS): new conditional
	(HAVE_XML_LIB): ditto

2004-12-31  Bruce Korb  <bkorb@gnu.org>

	= 5.6.5 Released
